{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/haruko/mirror-switch/schemas/mirror_config.schema.json",
  "title": "Mirror Switch Configuration",
  "description": "镜像源切换器配置文件 JSON Schema",
  "type": "object",
  "required": ["id", "name", "sources", "strategy"],
  "properties": {
    "id": {
      "type": "string",
      "description": "工具唯一标识符",
      "pattern": "^[a-z0-9_-]+$"
    },
    "name": {
      "type": "string",
      "description": "工具显示名称",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "工具描述",
      "minLength": 1
    },
    "detection": {
      "type": "object",
      "description": "工具检测配置",
      "properties": {
        "command": {
          "type": "string",
          "description": "检测命令"
        },
        "arguments": {
          "type": "array",
          "description": "命令参数",
          "items": {
            "type": "string"
          }
        },
        "customPaths": {
          "type": "array",
          "description": "自定义路径列表",
          "items": {
            "type": "string"
          }
        },
        "fallbackDetection": {
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "type": {
                  "const": "file"
                },
                "path": {
                  "type": "string"
                }
              },
              "required": ["type", "path"]
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "sources": {
      "type": "array",
      "description": "镜像源列表",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "name", "url"],
        "properties": {
          "id": {
            "type": "string",
            "description": "镜像源唯一标识符"
          },
          "name": {
            "type": "string",
            "description": "镜像源显示名称"
          },
          "url": {
            "type": "string",
            "description": "镜像源 URL",
            "format": "uri"
          },
          "description": {
            "type": "string",
            "description": "镜像源描述"
          },
          "region": {
            "type": "string",
            "description": "镜像源区域代码"
          },
          "requiresAuth": {
            "type": "boolean",
            "description": "是否需要认证"
          },
          "auth": {
            "type": "object",
            "description": "认证配置"
          }
        }
      }
    },
    "strategy": {
      "type": "object",
      "description": "切换策略配置",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["command", "xml", "jsonpath", "regex", "keyvalue"],
          "description": "策略类型"
        },
        "filePath": {
          "type": "string",
          "description": "配置文件路径"
        },
        "set": {
          "type": "object",
          "description": "设置配置"
        },
        "get": {
          "type": "object",
          "description": "获取配置"
        }
      }
    },
    "backup": {
      "type": "object",
      "description": "备份配置",
      "properties": {
        "filePath": {
          "type": "string",
          "description": "配置文件路径"
        },
        "backupFileName": {
          "type": "string",
          "description": "备份文件名"
        },
        "backupOriginal": {
          "type": "boolean",
          "description": "是否备份原文件"
        },
        "originalBackupSuffix": {
          "type": "string",
          "description": "原文件备份后缀"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "工具元数据",
      "properties": {
        "supportedPlatforms": {
          "type": "array",
          "description": "支持的平台",
          "items": {
            "type": "string"
          }
        },
        "supportsSpeedTest": {
          "type": "boolean",
          "description": "是否支持测速"
        },
        "dependencies": {
          "type": "array",
          "description": "依赖的工具",
          "items": {
            "type": "string"
          }
        },
        "documentationURL": {
          "type": "string",
          "description": "文档链接"
        }
      }
    },
    "postSwitchActions": {
      "type": "array",
      "description": "切换后的操作列表",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "操作类型"
          },
          "delay": {
            "type": "number",
            "description": "延迟时间（秒）"
          },
          "command": {
            "type": "string",
            "description": "要执行的命令"
          },
          "arguments": {
            "type": "array",
            "description": "命令参数",
            "items": {
              "type": "string"
            }
          },
          "showAlert": {
            "type": "object",
            "description": "显示提示框",
            "properties": {
              "title": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "success": {
                "type": "boolean"
              }
            }
          }
        }
      }
    }
  }
}
